<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ledger.io - Personal Finance Management</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div id="app"></div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Main App Script -->
    <script src="app.js"></script>

    <!-- Authentication Script -->
    <script>
        // Initialize Supabase client
        const SUPABASE_URL = 'https://yoursupabaseurl.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Check if user is already logged in
        async function checkAuth() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (user) {
                    // User is logged in
                    console.log('User logged in:', user.email);
                    // Redirect to dashboard or show main app
                    document.getElementById('app').innerHTML = '<div class="dashboard">Welcome to Ledger.io</div>';
                } else {
                    // User is not logged in, show login form
                    showLoginForm();
                }
            } catch (error) {
                console.error('Error checking auth:', error);
                showLoginForm();
            }
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('app').innerHTML = `
                <div class="auth-container">
                    <div class="auth-box">
                        <h1>Ledger.io</h1>
                        <p>Personal Finance Management</p>
                        <form id="login-form">
                            <input type="email" id="email" placeholder="Email" required>
                            <input type="password" id="password" placeholder="Password" autocomplete="current-password" required>
                            <button type="submit" class="btn-primary">Login</button>
                            <p class="auth-toggle">Don't have an account? <a href="#" onclick="toggleSignup(event)">Sign up</a></p>
                        </form>
                        <div id="signup-form" style="display: none;">
                            <h2>Create Account</h2>
                            <form id="register-form">
                                <input type="email" id="signup-email" placeholder="Email" required>
                                <input type="password" id="signup-password" placeholder="Password" autocomplete="new-password" required>
                                <input type="password" id="confirm-password" placeholder="Confirm Password" autocomplete="new-password" required>
                                <button type="submit" class="btn-primary">Sign Up</button>
                                <p class="auth-toggle">Already have an account? <a href="#" onclick="toggleSignup(event)">Login</a></p>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Attach event listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleSignup);
        }

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) throw error;

                console.log('Login successful:', data.user.email);
                checkAuth(); // Refresh auth state
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        // Handle signup
        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                });

                if (error) throw error;

                alert('Signup successful! Please check your email to confirm your account.');
                toggleSignup({ preventDefault: () => {} }); // Reset form
            } catch (error) {
                alert('Signup failed: ' + error.message);
            }
        }

        // Toggle between login and signup forms
        function toggleSignup(e) {
            if (e) e.preventDefault();
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
        }

        // Initialize auth on page load
        window.addEventListener('load', checkAuth);
    </script>
</body>
</html>